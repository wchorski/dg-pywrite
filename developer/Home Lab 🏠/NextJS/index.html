<!DOCTYPE html>
<html lang="en">
  <head>
    <title>NextJS</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://fastly.jsdelivr.net/npm/mermaid@9.4.0/dist/mermaid.min.js"></script>
<script>
    mermaid.initialize({
        startOnLoad: true,
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-sv0slik/5O0JIPdLBCR2A3XDg/1U3WuDEheZfI/DI5n8Yqc3h5kjrnr46FGBNiUAJF7rE4LHKwQ/SoSLRKAxEA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdn.jsdelivr.net/npm/lucide@0.115.0/dist/umd/lucide.min.js"></script>
<script>
    // Create callout icons
    window.addEventListener("load", () => {
        document.querySelectorAll(".callout").forEach((elem) => {
            const icon = getComputedStyle(elem).getPropertyValue('--callout-icon');
            const iconName = icon && icon.trim().replace(/^lucide-/, "");

            if (iconName) {
                const calloutTitle = elem.querySelector(".callout-title");

                if (calloutTitle) {
                    const calloutIconContainer = document.createElement("div");
                    const calloutIcon = document.createElement("i");

                    calloutIconContainer.appendChild(calloutIcon);
                    calloutIcon.setAttribute("icon-name", iconName);
                    calloutIconContainer.setAttribute("class", "callout-icon");
                    calloutTitle.insertBefore(calloutIconContainer, calloutTitle.firstChild);
                }
            }
        });

        lucide.createIcons();

        // Collapse callouts
        Array.from(document.querySelectorAll(".callout.is-collapsible")).forEach((elem) => {
            elem.querySelector('.callout-title').addEventListener("click", (event) => {
                if (elem.classList.contains("is-collapsed")) {
                    elem.classList.remove("is-collapsed");
                } else {
                    elem.classList.add("is-collapsed");
                }
            });
        });
    });
</script>


<script src="https://fastly.jsdelivr.net/npm/force-graph@1.43.0/dist/force-graph.min.js"></script>

<script defer src="https://fastly.jsdelivr.net/npm/@alpinejs/persist@3.11.1/dist/cdn.min.js"></script>
<script src="https://fastly.jsdelivr.net/npm/alpinejs@3.11.1/dist/cdn.min.js" defer></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer">
<script src="https://fastly.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<link href="/styles/digital-garden-base.css" rel="stylesheet">
    <link href="/styles/style.css" rel="stylesheet">


<link href="/styles/custom-style.css" rel="stylesheet"><link href="/styles/user/pywrite.css" rel="stylesheet">
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.webmanifest">





<style></style>
    
      <script async src="https://soup.tawtaw.site/ramen" data-website-id="fa4f8c5b-4767-4821-b063-f62c4cb90223"></script>
    
    
  </head>
  <body class="theme-dark markdown-preview-view markdown-rendered markdown-preview-section ">
    
    
    
      
    <nav class="navbar">
        <div class="navbar-inner">
            <a href="/" style="text-decoration: none;">
                <h1 style="margin: 15px !important;">Digital Garden</h1>
            </a>
        </div>
        
    </nav>
    
    

    

    <main class="content cm-s-obsidian ">
      <header>
        
        <div class="header-meta">
          </div>
      
      
      </header>
      
      
      <p><a class="tag" onclick="toggleTagSearch(this)" data-content="#javascript">#javascript</a> <a class="tag" onclick="toggleTagSearch(this)" data-content="#reactjs">#reactjs</a></p>
<blockquote>
<p>[<a href="nextjs.org%7C!info%5D%5D" target="_blank" class="external-link">nextjs.org)</a><br>
The React Framework. hybrid static &amp; server rendering, TypeScript support, smart bundling, route pre-fetching, and more. No config needed.</p>
</blockquote>
<h2 id="connections" tabindex="-1">connections</h2>
<ul>
<li><a class="internal-link" target="" data-note-icon="" href="/developer/Home Lab 🏠/Nginx Proxy Manager/">developer/Home Lab 🏠/Nginx Proxy Manager</a> for home routing</li>
<li>example app: <a class="internal-link is-unresolved" href="/404" target="">wchorski/heart-chart: cute app to make affection competitive (<a href="http://github.com" target="_blank" class="external-link">github.com</a>)</a>)</li>
</ul>
<h2 id="installation" tabindex="-1">installation</h2>
<ol>
<li><code>./compose.yml</code> via <a class="internal-link" target="" data-note-icon="" href="/developer/Home Lab 🏠/Docker/">developer/Home Lab 🏠/Docker</a>
<ol>
<li>&quot;app&quot; - NextJS App</li>
<li>&quot;mongo&quot; - MongoDB database</li>
</ol>
</li>
</ol>
<pre><code class="language-yml">version: '3'

services:
  mongo:
    restart: unless-stopped
    image: mongo
    environment:
      - MONGO_INITDB_ROOT_USERNAME=&lt;username&gt;
      - MONGO_INITDB_ROOT_PASSWORD=&lt;strongpassword&gt;
      - MONGO_INITDB_DATABASE=auth
    volumes:
      - ./database/mongo-db:/data/db
    networks:
      - nexthearts-network

  # nginx built inside
  app:
    image: nextjs-&lt;appname&gt;
    restart: unless-stopped
    build:
      dockerfile: Dockerfile
    ports:
      - 4050:3000
    environment:
      - MONGO_URI=mongo
      - MONGO_PORT=27017
      - MONGO_COLLECTION=&lt;appname&gt;
      - MONGO_USER=&lt;username&gt;
      - MONGO_PASSWORD=&lt;strongpassword&gt;

      # PROVIDERS
      - GITHUB_ID=
      - GITHUB_SECRET=
      - FACEBOOK_ID=
      - FACEBOOK_SECRET=
      - NEXTAUTH_URL=https://&lt;yourDomain&gt;
    depends_on:
      - mongo
    networks:
      - nexthearts-network
      - nginx-prox-mgmt-3_default # add to ngnix-prox-mgmt network for Docker DNS

networks:
  nexthearts-network:
    driver: bridge
  nginx-prox-mgmt-3_default: # so we can call service by DNS
    driver: bridge

volumes:
  mongo-db:
</code></pre>
<h3 id="server-side-rendered-dockerfile" tabindex="-1">Server Side Rendered Dockerfile</h3>
<ol start="2">
<li><code>./Dockerfile</code></li>
</ol>
<pre><code class="language-dockerfile">FROM node:16

RUN mkdir /app
WORKDIR /app
COPY package*.json ./

RUN npm install
COPY . ./
RUN npm run build

CMD [&quot;npm&quot;, &quot;start&quot;]
</code></pre>
<h3 id="static-site-dockerfile" tabindex="-1">Static Site Dockerfile</h3>
<pre><code class="language-Dockerfile">FROM node:16-alpine AS deps

# Check https://github.com/nodejs/docker-node/tree/b4117f9333da4138b03a546ec926ef50a31506c3#nodealpine to understand why libc6-compat might be needed.
RUN apk add --no-cache libc6-compat

WORKDIR /app
COPY package.json package-lock.json* ./
RUN \

if [ -f yarn.lock ]; then yarn --frozen-lockfile; \
elif [ -f package-lock.json ]; then npm ci; \
elif [ -f pnpm-lock.yaml ]; then yarn global add pnpm &amp;&amp; pnpm i --frozen-lockfile; \
else echo &quot;Lockfile not found.&quot; &amp;&amp; exit 1; \
fi

FROM node:16-alpine AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .
# Next.js collects completely anonymous telemetry data about general usage.
# Learn more here: https://nextjs.org/telemetry
# Uncomment the following line in case you want to disable telemetry during the build.
ENV NEXT_TELEMETRY_DISABLED 1

RUN npm run build


FROM node:16-alpine AS runner

WORKDIR /app
ENV NODE_ENV production
# Uncomment the following line in case you want to disable telemetry during runtime.
ENV NEXT_TELEMETRY_DISABLED 1
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs

COPY --from=builder /app/public ./public
# Automatically leverage output traces to reduce image size
# https://nextjs.org/docs/advanced-features/output-file-tracing
COPY --from=builder --chown=nextjs:nodejs /app/.next/standalone ./
COPY --from=builder --chown=nextjs:nodejs /app/.next/static ./.next/static

USER nextjs
EXPOSE 3000
ENV PORT 3000

CMD [&quot;node&quot;, &quot;server.js&quot;]
</code></pre>
<ol start="3">
<li><code>./.dockerignore</code></li>
</ol>
<pre><code>Dockerfile
**/Dockerfile
Dockerfile.dev
.dockerignore
**/node_modules
node_modules
.git
.gitignore
npm-debug.log
.next
.env.dev
.env.prod
</code></pre>
<hr>
<h2 id="tips-and-amp-tricks" tabindex="-1">Tips &amp; Tricks</h2>
<h3 id="multi-nexted-dynamic-routes" tabindex="-1">multi nexted dynamic routes</h3>
<ul>
<li><a href="https://dev.to/willholmes/multi-nested-dynamic-routes-in-nextjs-30f7" target="_blank" class="external-link">Multi Nested Dynamic Routes in NextJs - DEV Community 👩‍💻👨‍💻</a></li>
</ul>
<h3 id="absolute-imports" tabindex="-1">absolute imports</h3>
<ul>
<li>absolute paths instead of relative paths. Especially helpful when doing more automation / generation of links - <a class="internal-link is-unresolved" href="/404" target=""><a href="https://ahmadawais.com/next-js-absolute-imports-aliases/#:~:text=Next.js" target="_blank" class="external-link">https://ahmadawais.com/next-js-absolute-imports-aliases/#:~:text=Next.js</a> Absolute Imports %23 Basically you only need,via jsconfig.json (JS projects</a>%20or%20tsconfig.json%20(TS%20projects).)</li>
</ul>
<pre><code class="language-js">// Your jsconfig.json or tsconfig.json 
{ 
	&quot;compilerOptions&quot;: { 
		&quot;baseUrl&quot;: &quot;.&quot; 
	} 
}
</code></pre>
<h3 id="multiple-nested-routes-with-get-static-paths-a-href-https-stackoverflow-com-questions-61732511-how-to-use-multiple-nested-dynamic-routes-with-getstaticpaths-target-blank-class-external-link-source-a" tabindex="-1">multiple nested routes with getStaticPaths - <a href="https://stackoverflow.com/questions/61732511/how-to-use-multiple-nested-dynamic-routes-with-getstaticpaths" target="_blank" class="external-link">source</a></h3>
<p>folder structure</p>
<pre><code class="language-js">├── _app.jsx
├── _document.jsx
├── index.jsx
└── [type]
    └── [slug].jsx
</code></pre>
<p><code>./pages/[type]/[slug].jsx</code></p>
<pre><code class="language-javascript">const Test = (props) =&gt; {
    return (
       &lt;&gt;
           {props.slug}
       &lt;/&gt;
    );
};

export async function getStaticProps({params}) {
    return {
        props: params
    }
}

export async function getStaticPaths() {
    const posts = [
        {
            mainTag: 'programming',
            slug: 'hello-world'
        },
        {
            mainTag: 'programming',
            slug: 'nextjs-101'
        },
    ];

    return {
        paths: posts.map((posts) =&gt; {
            return {
                params: {
                    type: posts.mainTag,
                    slug: posts.slug,
                },
            };
        }),
        fallback: false,
    };
}

export default Test;
</code></pre>
<h3 id="markdown-image-with-nextjs-image" tabindex="-1">markdown image with nextjs/image</h3>
<p><a href="https://amirardalan.com/blog/use-next-image-with-react-markdown" target="_blank" class="external-link">Use Next/Image with React Markdown – Amir Ardalan</a> <em>tweaked code to fit with <a class="internal-link is-unresolved" href="/404" target="">developer/Home Lab 🏠/Obsidian.md</a></em><br>
<a href="https://forum.obsidian.md/t/how-can-i-change-the-size-of-images/2869/7?u=wchorski" target="_blank" class="external-link">https://forum.obsidian.md/t/how-can-i-change-the-size-of-images/2869/7?u=wchorski</a></p>
<pre><code class="language-tsx">// Markdown.tsx 
import Image from 'next/image' 
import ReactMarkdown from 'react-markdown'

export const Markdown = () =&gt; {
	const MarkdownComponents: object = { 
		p: (paragraph: { children?: boolean; node?: any}) =&gt; {
		  const { node } = paragraph
		
		  if (node.children[0].tagName === &quot;img&quot;) {
		    const image = node.children[0]
		    const metastring = image.properties.alt
		    const alt = metastring?.replace(/ *\{[^)]*\} */g, &quot;&quot;)
		    const metaWidth = metastring.match(/{([^}]+)x/)
		    const metaHeight = metastring.match(/x([^}]+)}/)
		    const width = metaWidth ? metaWidth[1] : &quot;768&quot;
		    const height = metaHeight ? metaHeight[1] : &quot;432&quot;
		    const isPriority = metastring?.toLowerCase().match('{priority}')
		    const hasCaption = metastring?.toLowerCase().includes('{caption:')
		    const caption = metastring?.match(/{caption: (.*?)}/)?.pop()
		
		    return (
		      &lt;div className=&quot;postImgWrapper&quot;&gt;
		        &lt;Image
		          src={image.properties.src}
			        width={width}
			        height={height}
			        className=&quot;postImg&quot;
			        alt={alt}
			        priority={isPriority}
			      /&gt;
			        {hasCaption ? &lt;div className=&quot;caption&quot; aria-label={caption}&gt;{caption}&lt;/div&gt; : null}
		      &lt;/div&gt;
		    )
		  }
		  return &lt;p&gt;{paragraph.children}&lt;/p&gt;
		},
	}
	
	
	return ( 
		&lt;ReactMarkdown children={your.content.here} components={MarkdownComponents} /&gt; 
	)
}



</code></pre>
<h3 id="keep-aspect-ratio-of-sized-nextjs-image" tabindex="-1">keep aspect ratio of sized nextjs/image</h3>
<p>I wanted to easily size images with one metric, the width, but keep the original aspect ratio intact.</p>
<p><a href="https://stackoverflow.com/a/71074979/15579591" target="_blank" class="external-link">source</a></p>
<pre><code class="language-jsx">const NaturalImage = (props: ImageProps) =&gt; {
  const [ratio, setRatio] = useState(16/9) // default to 16:9

  return (
    &lt;NextImage
      {...props}
      // set the dimension (affected by layout)
      width={200}
      height={200 / ratio}
      layout=&quot;fixed&quot; // you can use &quot;responsive&quot;, &quot;fill&quot; or the default &quot;intrinsic&quot;
      onLoadingComplete={({ naturalWidth, naturalHeight }) =&gt; 
        setRatio(naturalWidth / naturalHeight)
      }
    /&gt;
  )
}
</code></pre>
<hr>
<h2 id="trials-and-amp-tribulations" tabindex="-1">Trials &amp; Tribulations</h2>
<h3 id="es-lint-error" tabindex="-1">ESLint Error</h3>
<div class="callout " data-callout="error"><div class="callout-title"><div class="callout-title-inner"> error - ESLint: Error while loading rule '@next/next/no-html-link-for-pages': Invalid regular expression: /^/testingchar/(/$/: Unterminated group Occurred while linting /vercel/path0/pages/_app.tsx</div></div>
<div class="callout-content">
<p>
</p></div></div>
<p><a href="https://stackoverflow.com/a/64664131/15579591" target="_blank" class="external-link">source</a><br>
add to <code>.eslint.json</code>. Assuming <code>tsconfig.json</code> is also in the root directory</p>
<pre><code class="language-json">{
    &quot;parserOptions&quot;: {
        &quot;project&quot;: [&quot;tsconfig.json&quot;]
    },
}
</code></pre>
<h3 id="modual-not-found" tabindex="-1">modual not found</h3>
<div class="callout " data-callout="error"><div class="callout-title"><div class="callout-title-inner"> Module Not Found Can’t Resolve ‘fs’ in Next.js<br></div></div>
<div class="callout-content">
<p>
you'll find yourself commenting / uncommenting lines while troubleshooting.</p>
<p>if you're loading a server side script from <code>getStaticPaths</code> or <code>getStaticProps</code> and decide to comment out the function, remember to comment out the <strong>import</strong> of said script at the top of the <code>./pages/file.jsx</code></p>
</div></div>
<p><code>./pages/file.jsx</code></p>
<pre><code class="language-javascript">import { serverFunc } from &quot;libs/serverScript&quot;; 
// this will throw the *import* error unless you comment out above line too

export async function getStaticPaths() {

	// serverFunc() 

}
</code></pre>
<div class="callout " data-callout="warning"><div class="callout-title"><div class="callout-title-inner"> Catch alls can only be at end of structure<br></div></div>
<div class="callout-content">
<p>
<code>./pages/[...folder]/[...slug]</code>? - No sir</p>
</div></div>

      
      
    </main>

    

    
        <script>
      if (window.location.hash) {
        document.getElementById(window.location.hash.slice(1)).classList.add('referred');
      }
      window.addEventListener('hashchange', (evt) => {
        const oldParts = evt.oldURL.split("#");
        if (oldParts[1]) {
          document.getElementById(oldParts[1]).classList.remove('referred');
        }
        const newParts = evt.newURL.split("#");
        if (newParts[1]) {
          document.getElementById(newParts[1]).classList.add('referred');
        }
      }, false);
      const url_parts = window.location.href.split("#")
      const url = url_parts[0];
      const referrence = url_parts[1];
      document.querySelectorAll(".cm-s-obsidian > *[id]").forEach(function (el) {
        el.ondblclick = function(evt) {
          const ref_url = url + '#' + evt.target.id
          navigator.clipboard.writeText(ref_url);
      }
      });

      
    </script>
    <script src=" https://fastly.jsdelivr.net/npm/luxon@3.2.1/build/global/luxon.min.js "></script>
<script defer>
    TIMESTAMP_FORMAT = "MMM dd, yyyy h:mm a";
    document.querySelectorAll('.human-date').forEach(function (el) {
        el.innerHTML = luxon.DateTime.fromISO(el.getAttribute('data-date') || el.innerText).toFormat(TIMESTAMP_FORMAT);
      });
</script>
    
    
    <script>
lucide.createIcons({
            attrs: {
                class: ["svg-icon"]
            }
        });
</script>
  </body>
</html>
