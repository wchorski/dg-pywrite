<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Custom Audio Player Component</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://fastly.jsdelivr.net/npm/mermaid@9.4.0/dist/mermaid.min.js"></script>
<script>
    mermaid.initialize({
        startOnLoad: true,
    });
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/prism.min.js" integrity="sha512-hpZ5pDCF2bRCweL5WoA0/N1elet1KYL5mx3LP555Eg/0ZguaHawxNvEjF6O3rufAChs16HVNhEc6blF/rZoowQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-sv0slik/5O0JIPdLBCR2A3XDg/1U3WuDEheZfI/DI5n8Yqc3h5kjrnr46FGBNiUAJF7rE4LHKwQ/SoSLRKAxEA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://cdn.jsdelivr.net/npm/lucide@0.115.0/dist/umd/lucide.min.js"></script>
<script>
    // Create callout icons
    window.addEventListener("load", () => {
        document.querySelectorAll(".callout").forEach((elem) => {
            const icon = getComputedStyle(elem).getPropertyValue('--callout-icon');
            const iconName = icon && icon.trim().replace(/^lucide-/, "");

            if (iconName) {
                const calloutTitle = elem.querySelector(".callout-title");

                if (calloutTitle) {
                    const calloutIconContainer = document.createElement("div");
                    const calloutIcon = document.createElement("i");

                    calloutIconContainer.appendChild(calloutIcon);
                    calloutIcon.setAttribute("icon-name", iconName);
                    calloutIconContainer.setAttribute("class", "callout-icon");
                    calloutTitle.insertBefore(calloutIconContainer, calloutTitle.firstChild);
                }
            }
        });

        lucide.createIcons();

        // Collapse callouts
        Array.from(document.querySelectorAll(".callout.is-collapsible")).forEach((elem) => {
            elem.querySelector('.callout-title').addEventListener("click", (event) => {
                if (elem.classList.contains("is-collapsed")) {
                    elem.classList.remove("is-collapsed");
                } else {
                    elem.classList.add("is-collapsed");
                }
            });
        });
    });
</script>


<script src="https://fastly.jsdelivr.net/npm/force-graph@1.43.0/dist/force-graph.min.js"></script>

<script defer src="https://fastly.jsdelivr.net/npm/@alpinejs/persist@3.11.1/dist/cdn.min.js"></script>
<script src="https://fastly.jsdelivr.net/npm/alpinejs@3.11.1/dist/cdn.min.js" defer></script>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.25.0/themes/prism-okaidia.min.css" integrity="sha512-mIs9kKbaw6JZFfSuo+MovjU+Ntggfoj8RwAmJbVXQ5mkAX5LlgETQEweFPI18humSPHymTb5iikEOKWF7I8ncQ==" crossorigin="anonymous" referrerpolicy="no-referrer">
<script src="https://fastly.jsdelivr.net/npm/whatwg-fetch@3.6.2/dist/fetch.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<link href="/styles/digital-garden-base.css" rel="stylesheet">
    <link href="/styles/obsidian-base.css" rel="stylesheet">
    <link href="/styles/_theme.8f1d066a.css" rel="stylesheet">


<link href="/styles/custom-style.css" rel="stylesheet"><link href="/styles/user/pywrite.css" rel="stylesheet">
<link rel="icon" href="/favicon.ico" sizes="any">
<link rel="icon" href="/favicon.svg" type="image/svg+xml">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<link rel="manifest" href="/manifest.webmanifest">





<style></style>
    
      <script async src="https://soup.tawtaw.site/ramen" data-website-id="fa4f8c5b-4767-4821-b063-f62c4cb90223"></script>
    
    
  </head>
  <body class="theme-dark markdown-preview-view markdown-rendered markdown-preview-section ">
    
    
    
      
    <nav class="navbar">
        <div class="navbar-inner">
            <a href="/" style="text-decoration: none;">
                <h1 style="margin: 15px !important;">Digital Garden</h1>
            </a>
        </div>
        
    </nav>
    
    

    

    <main class="content cm-s-obsidian ">
      <header>
        
        <div class="header-meta">
          </div>
      
      
      </header>
      
      
      <p><a class="tag" onclick="toggleTagSearch(this)" data-content="#javascript">#javascript</a></p>
<p>I wanted a custom audio / music player that has some modern features such as a</p>
<ul>
<li>custom slider</li>
<li>custom controls</li>
<li>more visual feedback</li>
<li>analyzer / spectrogram</li>
</ul>
<p>Following <a href="https://www.youtube.com/watch?v=rkqqBA6ohc0&amp;t=10s" target="_blank" class="external-link">this video tutorial</a> I was able to create something from vanilla <a class="internal-link is-unresolved" href="/404" target="">developer/Javascript/Javascript</a> with a <a class="internal-link" target="" data-note-icon="" href="/developer/ReactJS/ReactJS/">developer/ReactJS/ReactJS</a> like structure.</p>
<p>plans to port this over to a real <a class="internal-link" target="" data-note-icon="" href="/developer/ReactJS/ReactJS/">developer/ReactJS/ReactJS</a> are to follow --&gt; <a class="internal-link" target="" data-note-icon="" href="/developer/ReactJS/Custom Audio Player Component - ReactJS Port/">developer/ReactJS/Custom Audio Player Component - ReactJS Port</a></p>
<h3 id="index-html" tabindex="-1">index.html</h3>
<pre><code class="language-html">&lt;head&gt;
	&lt;script src='./scripts/MusicPlayer.js'&gt;&lt;/script&gt;
&lt;/head&gt;


&lt;main className={styles.main}&gt;

	&lt;h1&gt;audio file visualizer&lt;/h1&gt;

	&lt;music-player 
		src=&quot;/audio/sinsweeps.mp3&quot; 
		title=&quot;Sick Track&quot; 
		artist=&quot;WilliaMusic&quot; 
		controls 
		// muted
		// loop
		preload
		crossorigin='anonymous'
&gt;&lt;/music-player&gt;
	
&lt;/main&gt;
</code></pre>
<h3 id="music-player-js" tabindex="-1">MusicPlayer.js</h3>
<pre><code class="language-js">{
  class MusicPlayer extends HTMLElement {

    playing = false
    currentTime = 0
    duration = 0
    volume = 0.4
    prevVolume = 0.4
    initialized = false
    title = 'untitled'
    artist = 'uknown'

    constructor(){
      super()

      this.attachShadow( {mode: 'open'} )
      this.render()
      this.initializeAudio()
      this.attachEvents()
    }

    static get observedAttributes(){
      return ['src', 'title', 'artist', 'muted', 'crossorigin', 'loop', 'preload']
    }

    async attributeChangedCallback(name, oldValue, newValue){
      if(name === 'src'){

        if(this.playing){
          await this.togglePLay() 
        }

        this.initialized = false
        this.render()
      }
      else if(name === 'title'){
        this.title = newValue

        if(this.titleElement){
          this.titleElement.textContent = this.title
        }
      }
      else if(name === 'artist'){
        this.artist = newValue

        if(this.artistElement){
          this.artistElement.textContent = this.artist
        }
      }
      else if(name === 'muted'){
        this.volumeBar.value = 0
        this.volume = 0

        if(this.artistElement){
          this.artistElement.textContent = this.artist
        }
      }

      for (let i = 0; i &lt; this.attributes.length; i++) {
        const attr = this.attributes[i]

        if(attr.specified &amp;&amp; attr.name !== 'title'){
          this.audio.setAttribute(attr.name, attr.value)
        }
        if(attr.specified &amp;&amp; attr.name !== 'artist'){
          this.audio.setAttribute(attr.name, attr.value)
        }
        
      }

      if(!this.initialized){
        this.initializeAudio()
      }
      console.log('--- ', name, oldValue, newValue);
    }

    initializeAudio(){
      if(this.initialized) return
      console.log('-- initializeAudio')

      this.initialized = true

      this.audioCtx = new AudioContext()

      this.track = this.audioCtx.createMediaElementSource(this.audio)
      this.gainNode = this.audioCtx.createGain()
      this.analyzerNode = this.audioCtx.createAnalyser()

      this.analyzerNode.fftSize = 2048
      this.bufferLength = this.analyzerNode.frequencyBinCount
      this.dataArray = new Uint8Array(this.bufferLength)
      this.analyzerNode.getByteFrequencyData(this.dataArray)

      this.track
      .connect(this.gainNode)
      .connect(this.analyzerNode)
      .connect(this.audioCtx.destination) //TODO input different sources

      this.attachEvents()
    }

    updateFrequency(){
      if(!this.playing) return

      this.analyzerNode.getByteFrequencyData(this.dataArray)

      this.canvasCtx.clearRect(0, 0, this.canvas.width, this.canvas.height)
      this.canvasCtx.fillStyle = 'rgba(255,255,255, 0.1)'
      this.canvasCtx.fillRect(0, 0, this.canvas.width, this.canvas.height)

      const barWidth = 3
      const gap = 2
      const barCount = this.bufferLength / ((barWidth + gap) - gap)
      let x = 0

      for(let i = 0; i &lt; barCount; i++){
        const perc = (this.dataArray[i] * 100) / 255
        const h = (perc * this.canvas.height) / 100

        this.canvasCtx.fillStyle = `rgba(${this.dataArray[i]}, 230, 200, 1)`
        this.canvasCtx.fillRect(x, this.canvas.height - h, barWidth, h)

        x += barWidth + gap
      }

      requestAnimationFrame(this.updateFrequency.bind(this))
    }

    attachEvents(){
      this.playPauseBtn.addEventListener('click', this.togglePLay.bind(this), false)

      this.muteButtonEl.addEventListener( 'click', e =&gt; {
        this.toggleMute()
      })

      this.volumeBar.addEventListener( 'input', this.changeVolume.bind(this), false)
      this.progressBar.addEventListener('input', () =&gt; {
        this.seekTo(this.progressBar.value)
      }, false )

      this.audio.addEventListener('loadedmetadata', () =&gt; {
        this.duration = this.audio.duration
        this.progressBar.max = this.duration

        // this.durationEl.textContent = `${mins}:${secs}`
        // console.log('duration', this.audio.duration );
        // console.log('currentTime', this.audio.currentTime );
      })

      this.audio.addEventListener('timeupdate', () =&gt; {
        this.updateAudioTime(this.audio.currentTime)
      })

      this.audio.addEventListener('ended', () =&gt; {
        this.playing = false
        this.playPauseBtn.textContent = '🔄'
      })
    }

    async togglePLay(){
      
      if(this.audioCtx.state === 'suspended') await this.audioCtx.resume()

      if(this.playing){
        await this.audio.pause()
        this.playing = false
        this.playPauseBtn.textContent = '▶️'
      } else {
        await this.audio.play()
        this.playing = true
        this.playPauseBtn.textContent = '⏸️'
        this.updateFrequency()
      }
    }

    seekTo(value){
      this.audio.currentTime = value
    }

    updateAudioTime(time){
      this.currentTime = time
      this.progressBar.value = this.currentTime

      const secs = `${parseInt( `${time % 60}`, 10)}`.padStart(2, '0')
      const mins =    parseInt(`${(time / 60) % 60}`, 10)

      this.currentTimeEl.textContent = `${mins}:${secs}`
    }

    changeVolume(){
      this.prevVolume = this.volume
      this.volume = Number(this.volumeBar.value)
      this.gainNode.gain.value = this.volume

      if(Number(this.volume) &gt; 1.5){
        this.volumeBar.parentNode.className = 'volume-bar high'
        this.muteButtonEl.textContent = '🔊'
      } 
      else if (Number(this.volume) &gt; 1){
        this.volumeBar.parentNode.className = 'volume-bar over'
        this.muteButtonEl.textContent = '🔉'
      }
      else if (Number(this.volume) &gt; 0){
        this.volumeBar.parentNode.className = 'volume-bar half'
        this.muteButtonEl.textContent = '🔈'
      }
      else{
        this.volumeBar.parentNode.className = 'volume-bar'
        this.muteButtonEl.textContent = '🔇'
      }
    }

    toggleMute(){
      console.log('mute toggled')

      this.volumeBar.value = this.volume === 0
        ? this.prevVolume
        : 0 
      this.changeVolume()
    }

    render() {
      this.shadowRoot.innerHTML = `
        &lt;figure class=&quot;audio-player&quot;&gt;
          &lt;figcaption class=&quot;audio-title&quot;&gt;&lt;/figcaption&gt;
          &lt;figcaption class=&quot;audio-artist&quot;&gt;&lt;/figcaption&gt;

          &lt;audio style=&quot;display: none&quot;&gt;&lt;/audio&gt;

          &lt;canvas class=&quot;visualizer&quot; style=&quot;width: 100%; height: 60px&quot;&gt;&lt;/canvas&gt;
          
          &lt;div class='audio-controls'&gt;
            &lt;div class='audio-transport'&gt;
              &lt;button class=&quot;prev-btn&quot; type=&quot;button&quot;&gt; ⏮️ &lt;/button&gt;
              &lt;button class=&quot;play-btn&quot; type=&quot;button&quot;&gt; ▶️ &lt;/button&gt;
              &lt;button class=&quot;next-btn&quot; type=&quot;button&quot;&gt; ⏭️ &lt;/button&gt;
            &lt;/div&gt;

            &lt;div class=&quot;volume-bar&quot;&gt;
              &lt;button class=&quot;mute-btn&quot; type=&quot;button&quot;&gt; 🔈 &lt;/button&gt;
              &lt;input type=&quot;range&quot; min=&quot;0&quot; max=&quot;2&quot; step=&quot;0.01&quot; value=&quot;${this.volume}&quot; class=&quot;volume-field&quot;&gt;
            &lt;/div&gt;
          &lt;/div&gt;


          &lt;div class=&quot;progress-indicator&quot;&gt;
            &lt;span class=&quot;audio-time current-time&quot;&gt;0:0&lt;/span&gt;
            &lt;input type=&quot;range&quot; max=&quot;100&quot; value=&quot;0&quot; class=&quot;progress-bar&quot;&gt;
            &lt;span class=&quot;audio-time duration&quot;&gt;0:00&lt;/span&gt;
          &lt;/div&gt;

        &lt;/figure&gt;

      `

      this.canvas             = this.shadowRoot.querySelector('canvas')
      this.canvasCtx          = this.canvas.getContext('2d')

      this.audio              = this.shadowRoot.querySelector('audio')
      this.playPauseBtn       = this.shadowRoot.querySelector('.play-btn')
      this.titleElement       = this.shadowRoot.querySelector('.audio-title');
      this.artistElement       = this.shadowRoot.querySelector('.audio-artist');
      this.volumeBar          = this.shadowRoot.querySelector('.volume-field');
      this.muteButtonEl        = this.shadowRoot.querySelector('.mute-btn');
      this.progressIndicator  = this.shadowRoot.querySelector('.progress-indicator');
      this.currentTimeEl      = this.progressIndicator.children[0];
      this.progressBar        = this.progressIndicator.children[1];
      this.durationEl         = this.progressIndicator.children[2];
    }
  }

  customElements.define( 'music-player', MusicPlayer)
}
</code></pre>
<h3 id="style-css" tabindex="-1">style.css</h3>
<pre><code class="language-css">	:host{
		width: 100%;
		max-width: 400px;
		font-family: sans-serif;
	}

	:host * {
		box-sizing: border-box
	}

	.audio-player{
		background: <a class="tag" onclick="toggleTagSearch(this)" data-content="#163532">#163532</a>;
		color: <a class="tag" onclick="toggleTagSearch(this)" data-content="#fff">#fff</a>;
		border-radius: 5px;
		padding: 1em;
		align-items: center;
		// display: flex;
		position: relative;
		margin: 0;
	}

	.audio-title{
		font-weight: bold;
	}

	.audio-artist{
		opacity: .7;
		font-weight: 100;
		font-size: .9rem;
		margin-bottom: 1em;
	}

	
	.progress-indicator{
		width: 100%;
		padding: 1em .5em 1em .5em;
		display: flex;
		justify-content: center;
		align-items: center;
	}
	
	input[type=&quot;range&quot;], .progress-bar{
		width: 70%;
		height: 100%;
		border-radius: 500px;
		appearance: none;
		background: none;
		overflow: hidden;
		cursor: pointer;
	}

	input[type=&quot;range&quot;]::-webkit-slider-runnable-track{
		background: grey;
		height: 10px;
		border-radius: 500px;
		appearance: none;
	}

	input[type=&quot;range&quot;]::-webkit-slider-thumb{
		width: 0;
		// border-radius: 50%;
		box-shadow: -300px 0 0 300px dimgrey; 
		appearance: none;
		background: dimgrey;
		width: 6px;
		height: 20px;
		margin: -7px 0 0 0;
		border-radius: 12px;
	}

	div:has(input[type=&quot;range&quot;]):hover input[type=&quot;range&quot;]::-webkit-slider-thumb{
		background: white;
	}
	
	.audio-time{
		opacity: .7;
		font-size: .7rem;
		font-weight: 100;
		margin: 0 .4em;
	}

	.audio-controls{
		display: flex;
		align-items: center;
		justify-content: space-between;
		margin-bottom: 1em;
	}

	.volume-bar {
		position: relative;
	}
	
	.volume-bar.half button{
		color: blue;
	}
	.volume-bar.over button{
		color: red;
	}
  
    
</code></pre>
<hr>
<h2 id="credits" tabindex="-1">Credits</h2>
<ul>
<li><a href="https://www.youtube.com/watch?v=rkqqBA6ohc0&amp;t=10s" target="_blank" class="external-link">Custom Audio Player with Web Component and Web Audio API - YouTube</a></li>
</ul>

      
      
    </main>

    

    
        <script>
      if (window.location.hash) {
        document.getElementById(window.location.hash.slice(1)).classList.add('referred');
      }
      window.addEventListener('hashchange', (evt) => {
        const oldParts = evt.oldURL.split("#");
        if (oldParts[1]) {
          document.getElementById(oldParts[1]).classList.remove('referred');
        }
        const newParts = evt.newURL.split("#");
        if (newParts[1]) {
          document.getElementById(newParts[1]).classList.add('referred');
        }
      }, false);
      const url_parts = window.location.href.split("#")
      const url = url_parts[0];
      const referrence = url_parts[1];
      document.querySelectorAll(".cm-s-obsidian > *[id]").forEach(function (el) {
        el.ondblclick = function(evt) {
          const ref_url = url + '#' + evt.target.id
          navigator.clipboard.writeText(ref_url);
      }
      });

      
    </script>
    <script src=" https://fastly.jsdelivr.net/npm/luxon@3.2.1/build/global/luxon.min.js "></script>
<script defer>
    TIMESTAMP_FORMAT = "MMM dd, yyyy h:mm a";
    document.querySelectorAll('.human-date').forEach(function (el) {
        el.innerHTML = luxon.DateTime.fromISO(el.getAttribute('data-date') || el.innerText).toFormat(TIMESTAMP_FORMAT);
      });
</script>
    
    
    <script>
lucide.createIcons({
            attrs: {
                class: ["svg-icon"]
            }
        });
</script>
  </body>
</html>
