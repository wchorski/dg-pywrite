<p>Here is a simple backup solution for a client to remote server. Assuming you've already set up a [[developer/Linux/Hardened SSH Server|developer/Linux/Hardened SSH Server]] with key login</p>
<p>In this example I'm backing up my [[developer/Home Lab üè†/Nextcloud|developer/Home Lab üè†/Nextcloud]] data (pictures, documents, etc.) to a remote server for my 'offsite backup'</p>
<ul>
<li><code>LOCALDRIVE</code> === assuming you mounted your external drive with lots of space here</li>
<li><code>REMOTESERVER.lan</code> === could be an offsite domain or you could just backup to a local IP on the same network</li>
<li><code>LOG_DIR</code> === this is where the <code>status.log</code> &amp; <code>sync.log</code> will be created and updated
<ul>
<li><code>status.log</code> is a simple 'OK' or 'ERROR' with date synced. Great to print to dashboards for a quick glance</li>
<li><code>sync.log</code> is the full details of the last [[developer/Linux/rsync|developer/Linux/rsync]] run. Useful if the script ERRORs out and you have to see what went wrong.</li>
</ul>
</li>
</ul>
<pre><code class="language-bash">#!/bin/bash

# Variables
TARGET=&quot;nextcloud&quot;
SOURCE_DIR=&quot;/mnt/LOCALDRIVE/${TARGET}&quot;
DEST_USER=&quot;REMOTEUSER&quot;
DEST_HOST=&quot;REMOTESERVER.lan&quot;
## directory is inclusive, it will also copy folder along with it
DEST_DIR=&quot;/mnt/REMOTESTORAGE&quot;

LOG_DIR=&quot;/home/LOCALUSER/scripts/backups/${TARGET}&quot;
NOW=`date +'%Y-%m-%d_%H%M%S'`
LOG_FILE=&quot;${LOG_DIR}/sync.log&quot; 
STATUS_FILE=&quot;${LOG_DIR}/status.log&quot;

echo &quot;$NOW \n&quot; &gt; &quot;$LOG_FILE&quot;

# Rsync command
rsync -avzP -e ssh &quot;$SOURCE_DIR&quot; &quot;${DEST_USER}@${DEST_HOST}:${DEST_DIR}&quot; &gt;&gt; &quot;$LOG_FILE&quot; 2&gt;&amp;1

RSYNC_EXIT_CODE=$?

LINECOUNT=$(wc -l sync.log)

# Update status based on exit code
if [ $RSYNC_EXIT_CODE -eq 0 ]; then
    echo &quot;OK $NOW $LINECOUNT&quot; &gt; &quot;$STATUS_FILE&quot;
else
    echo &quot;ERROR $NOW $LINECOUNT&quot; &gt; &quot;$STATUS_FILE&quot;
fi
</code></pre>
<h2 id="troubleshooting" tabindex="-1">Troubleshooting</h2>
<p>I'm getting 2 different errors when trying to sync my nextcloud data files</p>
<ol>
<li><code>could not make way for new regular file: /FILEPATH</code></li>
<li><code>cannot delete non-empty directory: /FILEPATH</code></li>
</ol>
<p>#todo</p>
<ul class="task-list">
<li>[[developer/Linux/Bash Script Status Animation| ]]</li>
<li class="task-list-item"><input type="checkbox" id="cbx_0" disabled="true"><label for="cbx_0"> permissions issue could come up (like with nextcloud). make sure user is added to <code>www-data</code> group I think?</label></li>
</ul>
<hr>
<h2 id="backlinks" tabindex="-1">Backlinks</h2>
<ul>
<li>[[developer/Linux/Linux|developer/Linux/Linux]]</li>
</ul>
