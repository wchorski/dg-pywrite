<p>Add blockers track for common external endpoints that track data. We can get around this by setting up a proxy in [[developer/Home Lab üè†/NextJS|developer/Home Lab üè†/NextJS]] to funel the external script to an enpoint that is from our domain</p>
<p>For a live example of this, check out [[developer/Projectsüìê/Make-a-Gram|developer/Projectsüìê/Make-a-Gram]]</p>
<h2 id="env" tabindex="-1">.env</h2>
<pre><code class="language-env">NEXT_PUBLIC_UMAMI_ID=&quot;asdlk-8398-23ksdfas-sa343&quot;
NEXT_PUBLIC_UMAMI_URL=&quot;https://DOMAIN_WHERE_UMAMI_IS_HOSTED.site&quot;
NEXT_PUBLIC_UMAMI_SCRIPT=&quot;ramen&quot;
</code></pre>
<p>You've probably noticed the <code>ramen</code> as the <strong>Umami_Script</strong>. This is a custom endpoint set up via the <a href="https://umami.is/docs/environment-variables" target="_blank" class="external-link">Environment variables | umami</a> &quot;TRACKER_SCRIPT_NAME&quot;</p>
<p>Checkout the [[developer/Home Lab üè†/umami|developer/Home Lab üè†/umami]] to see how I set it up in the <code>docker-compose.yml</code></p>
<h2 id="next-config-js" tabindex="-1">next.config.js</h2>
<pre><code class="language-js">/** @type {import('next').NextConfig} */

const ANALYTICS_URL = process.env.NEXT_PUBLIC_UMAMI_URL + '/:match*'
console.log('ANALYTICS_URL', ANALYTICS_URL);

const nextConfig = {
  reactStrictMode: true,
  swcMinify: true,
  async rewrites() {
    return [
      {
        source: '/stts/:match*',
        destination: ANALYTICS_URL,
      },
    ]
  },
}

module.exports = nextConfig
</code></pre>
<h2 id="app-js" tabindex="-1">__app.js</h2>
<pre><code class="language-jsx">// /pages/__app.js

import '../styles/globals.css'
import  Script  from &quot;next/script&quot;;

const UMAMI_SCRIPT = process.env.NEXT_PUBLIC_UMAMI_SCRIPT
const UMAMI_ID = process.env.NEXT_PUBLIC_UMAMI_ID

function MyApp({ Component, pageProps }) {


  return (&lt;&gt;

    &lt;Script
      id=&quot;umami-next&quot;
      strategy=&quot;afterInteractive&quot;
      async
      data-website-id={UMAMI_ID}
      src={`/stts/${UMAMI_SCRIPT}`}
    /&gt;
 
    
    &lt;Component {...pageProps} /&gt;
&lt;/&gt;)}

export default MyApp
</code></pre>
<hr>
<h2 id="credits" tabindex="-1">Credits</h2>
<ul>
<li><a href="https://umami.is/docs/running-on-vercel" target="_blank" class="external-link">Running on Vercel | umami</a></li>
</ul>
