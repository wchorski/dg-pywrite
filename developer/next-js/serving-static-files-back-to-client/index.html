<p>After I [[developer/NextJS/Upload Files with next-connect and Multer|developer/NextJS/Upload Files with next-connect and Multer]] I wanted to serve those same files back to the client. Ahh but not so fast says [[developer/Home Lab üè†/NextJS|developer/Home Lab üè†/NextJS]].</p>
<blockquote>
<p>[[<a href="http://nextjs.org" target="_blank" class="external-link">nextjs.org</a>)](<a href="https://nextjs.org/docs/basic-features/static-file-serving%5C%7C!note" target="_blank" class="external-link">https://nextjs.org/docs/basic-features/static-file-serving\|!note</a>]]<br>
Only assets that are in the¬†<code>public</code>¬†directory at¬†[[<a href="https://nextjs.org/docs/api-reference/cli#build%5C%7Chttps://nextjs.org/docs/api-reference/cli#build" target="_blank" class="external-link">https://nextjs.org/docs/api-reference/cli#build\|https://nextjs.org/docs/api-reference/cli#build</a>]]¬†will be served by Next.js. Files added at runtime won't be available. We recommend using a third party service like¬†<a href="https://aws.amazon.com/s3/" target="_blank" class="external-link">AWS S3</a>¬†for persistent file storage.</p>
</blockquote>
<h3 id="create-an-api-endpoint" tabindex="-1">create an api endpoint</h3>
<p><code>./pages/api/images-endpoint/[...slug].js</code></p>
<pre><code class="language-javascript">import fs from &quot;fs&quot;;
import path from &quot;path&quot;;

export default function handler(req, res) {
  const imagePath = req.query.slug.join(&quot;/&quot;);
  const filePath = path.resolve(&quot;.&quot;, `./public/uploads/${imagePath}`);
  const imageBuffer = fs.readFileSync(filePath);
  res.setHeader(&quot;Content-Type&quot;, &quot;image/jpg&quot;);
  return res.send(imageBuffer);
}
</code></pre>
<h2 id="seperate-nginx-server" tabindex="-1">Seperate Nginx server</h2>
<p>Try and use nginx or another webserver to serve the public directory. That way it will serve newly added files without having to write extra code to serve files in nextjs. <a href="https://stackoverflow.com/users/989394/bas080" target="_blank" class="external-link">link</a></p>
<pre><code class="language-javascript">server {
  /images/ {
    root /var/www/site/public
  }
}
</code></pre>
<h2 id="express-server-inside-next-js" tabindex="-1">Express server inside NextJS</h2>
<p><a href="https://stackoverflow.com/a/70490960/15579591" target="_blank" class="external-link">https://stackoverflow.com/a/70490960/15579591</a></p>
<h2 id="other-stuff" tabindex="-1">other stuff</h2>
<p>Looks like we could fiddle with a custom server but that looks like a bigger headache [[<a href="http://nextjs.org" target="_blank" class="external-link">nextjs.org</a>)](<a href="https://nextjs.org/docs/advanced-features/custom-server%5C%7CAdvanced" target="_blank" class="external-link">https://nextjs.org/docs/advanced-features/custom-server\|Advanced</a> Features: Custom Server ]]</p>
<hr>
<h2 id="credits" tabindex="-1">Credits</h2>
<ul>
<li><a href="https://stackoverflow.com/a/72031304/15579591" target="_blank" class="external-link">https://stackoverflow.com/a/72031304/15579591</a> - thanks to <a href="https://stackoverflow.com/users/11503874/rizwan-amjad" target="_blank" class="external-link">User Rizwan Amjad </a></li>
<li>[[<a href="https://stackoverflow.com/questions/68225815/how-to-access-files-uploaded-to-the-public-folder-in-next-js#:~:text=From" target="_blank" class="external-link">https://stackoverflow.com/questions/68225815/how-to-access-files-uploaded-to-the-public-folder-in-next-js#:~:text=From</a> Next.js documentation%3A Only assets that are in,to them in the app at run time.|<a href="https://stackoverflow.com/questions/68225815/how-to-access-files-uploaded-to-the-public-folder-in-next-js#:~:text=From" target="_blank" class="external-link">https://stackoverflow.com/questions/68225815/how-to-access-files-uploaded-to-the-public-folder-in-next-js#:~:text=From</a> Next.js documentation%3A Only assets that are in,to them in the app at run time.]]</li>
</ul>
